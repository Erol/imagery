<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Documentation by YARD 0.5.4</title>
<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html" title="Index">Index</a> &raquo; 
    <span class="title">File: README</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><div id='filecontents'><h1>Imagery</h1>

<p>(See documentation at <a href="http://labs.sinefunc.com/imagery/doc">http://labs.sinefunc.com/imagery/doc</a>)</p>

<h2>Image manipulation should be simple. It should be customizable. It should allow for flexibility. Imagery attempts to solve these.</h2>

<h3>Imagery favors:</h3>

<ol>
<li>Simplicity and explicitness over magic DSLs.</li>
<li>OOP principles such as inheritance and composition.</li>
<li>Flexibility and extensibility.</li>
<li>Not being tied to any form of ORM.</li>
</ol>


<h2>1. Simplicity and Explicitness</h2>

<p>To get started using Imagery you only need ImageMagick, ruby and Imagery of
course.</p>

<pre class="code"># on debian based systems
sudo apt-get install imagemagick
# or maybe using macports
sudo port install ImageMagick
[sudo] gem install imagery
</pre>

<p>Then you may proceed using it.</p>

<pre class="code"><span class='id require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>rubygems</span><span class='tstring_end'>'</span></span>
<span class='id require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>imagery</span><span class='tstring_end'>'</span></span>

<span class='const'>Photo</span> <span class='op'>=</span> <span class='const'>Class</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='const'>Struct</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span><span class='rparen'>)</span>

<span class='id i'>i</span> <span class='op'>=</span> <span class='const'>Imagery</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='const'>Photo</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='int'>1001</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='id i'>i</span><span class='period'>.</span><span class='id root'>root</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/some/path/here</span><span class='tstring_end'>'</span></span>
<span class='id i'>i</span><span class='period'>.</span><span class='id sizes'>sizes</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='symbol'>:thumb</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>48x48^</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>48x48</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:large</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>480x320</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
<span class='id i'>i</span><span class='period'>.</span><span class='id save'>save</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/some/path/to/image.jpg</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

<span class='const'>File</span><span class='period'>.</span><span class='id exist?'>exist?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/some/path/here/public/system/photo/1001/thumb.png</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='comment'># =&gt; true
</span>
<span class='const'>File</span><span class='period'>.</span><span class='id exist?'>exist?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/some/path/here/public/system/photo/1001/large.png</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='comment'># =&gt; true
</span>
<span class='const'>File</span><span class='period'>.</span><span class='id exist?'>exist?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/some/path/here/public/system/photo/1001/original.png</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='comment'># =&gt; true
</span>
<span class='comment'># the defaut is to use the .id and the name of the class passed,
</span><span class='comment'># but you can specify a different scheme.
</span>
<span class='id i'>i</span> <span class='op'>=</span> <span class='const'>Imagery</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='const'>Photo</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='int'>1001</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='backtick'>`</span><span class='tstring_content'>uuidgen</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id strip'>strip</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>photos</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id i'>i</span><span class='period'>.</span><span class='id root'>root</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/some/path/here</span><span class='tstring_end'>'</span></span>
<span class='id i'>i</span><span class='period'>.</span><span class='id file'>file</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/some/path/here/public/system/photos/1c2030a6-6bfa-11df-8997-67a71f1f84c7/original.png</span><span class='tstring_end'>'</span></span>
<span class='comment'># =&gt; true
</span></pre>

<h2>2. OOP Principles (that we already know)</h2>

<h3>Ohm example (See <a href="http://ohm.keyvalue.org">http://ohm.keyvalue.org</a>)</h3>

<pre class="code"><span class='comment'># Imagery will use ROOT_DIR if its available
</span><span class='const'>ROOT_DIR</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/u/apps/site/current</span><span class='tstring_end'>&quot;</span></span>

<span class='kw'>class</span> <span class='const'>User</span> <span class='op'>&lt;</span> <span class='const'>Ohm</span><span class='op'>::</span><span class='const'>Model</span>
  <span class='id include'>include</span> <span class='const'>Ohm</span><span class='op'>::</span><span class='const'>Callbacks</span>

  <span class='id after'>after</span> <span class='symbol'>:save</span><span class='comma'>,</span> <span class='symbol'>:write_avatar</span>

  <span class='kw'>def</span> <span class='id avatar='>avatar=</span><span class='lparen'>(</span><span class='id fp'>fp</span><span class='rparen'>)</span>
    <span class='ivar'>@avatar_fp</span> <span class='op'>=</span> <span class='id fp'>fp</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id avatar'>avatar</span>
    <span class='ivar'>@avatar</span> <span class='op'>||=</span> 
      <span class='const'>Imagery</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id i'>i</span><span class='op'>|</span>
        <span class='id i'>i</span><span class='period'>.</span><span class='id sizes'>sizes</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='symbol'>:thumb</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>48x48^</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>48x48</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:medium</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>120x120</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
      <span class='kw'>end</span>
  <span class='kw'>end</span>

<span class='id protected'>protected</span>
  <span class='kw'>def</span> <span class='id write_avatar'>write_avatar</span>
    <span class='id avatar'>avatar</span><span class='period'>.</span><span class='id save'>save</span><span class='lparen'>(</span><span class='ivar'>@avatar_fp</span><span class='lbracket'>[</span><span class='symbol'>:tempfile</span><span class='rbracket'>]</span><span class='rparen'>)</span>  <span class='kw'>if</span> <span class='ivar'>@avatar_fp</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='comment'># Since we're using composition, we can customize the dimensions on an 
</span><span class='comment'># instance level.
</span><span class='kw'>class</span> <span class='const'>Collage</span> <span class='op'>&lt;</span> <span class='const'>Ohm</span><span class='op'>::</span><span class='const'>Model</span>
  <span class='id attribute'>attribute</span> <span class='symbol'>:width</span>
  <span class='id attribute'>attribute</span> <span class='symbol'>:height</span>

  <span class='kw'>def</span> <span class='id photo'>photo</span>
    <span class='ivar'>@photo</span> <span class='op'>||=</span> 
      <span class='const'>Imagery</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id i'>i</span><span class='op'>|</span>
        <span class='id i'>i</span><span class='period'>.</span><span class='id sizes'>sizes</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='symbol'>:thumb</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%sx%s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='lbracket'>[</span><span class='id width'>width</span><span class='comma'>,</span> <span class='id height'>height</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
      <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='comment'># For cases where we want to use S3 for some and normal filesystem for others
</span><span class='kw'>class</span> <span class='const'>S3Photo</span> <span class='op'>&lt;</span> <span class='const'>Imagery</span><span class='op'>::</span><span class='const'>Model</span>
  <span class='id include'>include</span> <span class='const'>Imagery</span><span class='op'>::</span><span class='const'>S3</span>
  <span class='id s3_bucket'>s3_bucket</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>my-bucket</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span>

<span class='comment'># then maybe some other files are using cloudfront
</span><span class='kw'>class</span> <span class='const'>CloudfrontPhoto</span> <span class='op'>&lt;</span> <span class='const'>Imagery</span><span class='op'>::</span><span class='const'>Model</span>
  <span class='id include'>include</span> <span class='const'>Imagery</span><span class='op'>::</span><span class='const'>S3</span>
  <span class='id s3_bucket'>s3_bucket</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>my-bucket</span><span class='tstring_end'>'</span></span>
  <span class='id s3_distribution_domain'>s3_distribution_domain</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>assets.site.com</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span>
</pre>

<h2>3. Flexibility and Extensibility</h2>

<h3>Existing plugins: Faking and S3</h3>

<h4>Imagery::S3</h4>

<p>As was shown in some examples above you can easily do S3 integration.
The access credentials are assumed to be stored in</p>

<pre class="code"><span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AMAZON_ACCESS_KEY_ID</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
<span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AMAZON_SECRET_ACCESS_KEY</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
</pre>

<p>you can do this by setting it on your .bash_profile / .bashrc or just
manually setting them somewhere in your appication</p>

<pre class="code"><span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AMAZON_ACCESS_KEY_ID</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>_access_key_id_</span><span class='tstring_end'>'</span></span>
<span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AMAZON_SECRET_ACCESS_KEY</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>_secret_access_key_</span><span class='tstring_end'>'</span></span>
</pre>

<p>Now you can just start using it:</p>

<pre class="code"><span class='const'>Photo</span> <span class='op'>=</span> <span class='const'>Class</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='const'>Struct</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span><span class='rparen'>)</span>

<span class='kw'>class</span> <span class='const'>Imagery</span><span class='op'>::</span><span class='const'>Model</span>
  <span class='id include'>include</span> <span class='const'>Imagery</span><span class='op'>::</span><span class='const'>S3</span>
  <span class='id s3_bucket'>s3_bucket</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>my-bucket</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span>

<span class='id i'>i</span> <span class='op'>=</span> <span class='const'>Imagery</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='const'>Photo</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='int'>1001</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='id i'>i</span><span class='period'>.</span><span class='id root'>root</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/tmp</span><span class='tstring_end'>'</span></span>
<span class='id i'>i</span><span class='period'>.</span><span class='id save'>save</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/some/path/to/image.jpg</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
</pre>

<h4>Imagery::Faking</h4>

<p>When doing testing, you definitely don't want to run image
resizing everytime. Enter Faking.</p>

<pre class="code"><span class='comment'># in your test_helper / spec_helper
</span><span class='const'>Imagery</span><span class='op'>::</span><span class='const'>Model</span><span class='period'>.</span><span class='id send'>send</span> <span class='symbol'>:include</span><span class='comma'>,</span> <span class='const'>Imagery</span><span class='op'>::</span><span class='const'>Faking</span>
<span class='const'>Imagery</span><span class='op'>::</span><span class='const'>Model</span><span class='period'>.</span><span class='id mode'>mode</span> <span class='op'>=</span> <span class='symbol'>:fake</span>

<span class='comment'># but what if we want to run it for real on a case to case basis?
</span><span class='comment'># sure we can!
</span><span class='const'>Imagery</span><span class='op'>::</span><span class='const'>Model</span><span class='period'>.</span><span class='id real'>real</span> <span class='lbrace'>{</span>
  <span class='comment'># do some imagery testing here
</span><span class='rbrace'>}</span>
</pre>

<h4>Imagery::Test</h4>

<p>There is a module you can include in your test context to automate the pattern
of testing / faking on an opt-in basis.</p>

<pre class="code"><span class='comment'># in your test_helper / spec_helper
</span><span class='kw'>class</span> <span class='const'>Test</span><span class='op'>::</span><span class='const'>Unit</span><span class='op'>::</span><span class='const'>TestCase</span>
  <span class='id include'>include</span> <span class='const'>Imagery</span><span class='op'>::</span><span class='const'>Test</span>
<span class='kw'>end</span>

<span class='comment'># now when you do some testing... (User assumes the user example above)
</span><span class='id imagery'>imagery</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id is_real'>is_real</span><span class='op'>|</span>
  <span class='id user'>user</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='symbol'>:avatar</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='label'>tempfile:</span> <span class='const'>File</span><span class='period'>.</span><span class='id open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>avatar.jpg</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id user'>user</span><span class='period'>.</span><span class='id save'>save</span>

  <span class='kw'>if</span> <span class='id is_real'>is_real</span>
    <span class='id assert'>assert</span> <span class='const'>File</span><span class='period'>.</span><span class='id exist?'>exist?</span><span class='lparen'>(</span><span class='id user'>user</span><span class='period'>.</span><span class='id avatar'>avatar</span><span class='period'>.</span><span class='id file'>file</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>

<p>Running your test suite:</p>

<pre class="code">REAL_IMAGERY=true rake test
</pre>

<p>It's off by default though, so you don't have to do anything to make sure
Imagery doesn't run.</p>

<h3>Extending Imagery</h3>

<p>By making use of standard Ruby idioms, we can easily do lots with it.
Exensibility is addressed via Ruby modules for example:</p>

<pre class="code"><span class='kw'>module</span> <span class='const'>Imagery</span>
  <span class='kw'>module</span> <span class='const'>MogileStore</span>
    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id included'>included</span><span class='lparen'>(</span><span class='id base'>base</span><span class='rparen'>)</span>
      <span class='kw'>class</span> <span class='op'>&lt;&lt;</span> <span class='id base'>base</span>
        <span class='id attr_accessor'>attr_accessor</span> <span class='symbol'>:mogile_config</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='kw'>def</span> <span class='id save'>save</span><span class='lparen'>(</span><span class='id io'>io</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='kw'>super</span>
        <span class='comment'># do some mogie FS stuff here
</span>      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='kw'>def</span> <span class='id delete'>delete</span>
      <span class='kw'>super</span>
      <span class='comment'># remove the mogile stuff here
</span>    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='comment'># Now just include the module however, whenever you want
</span><span class='kw'>module</span> <span class='const'>Imagery</span>
  <span class='kw'>class</span> <span class='const'>Model</span>
    <span class='id include'>include</span> <span class='const'>Imagery</span><span class='op'>::</span><span class='const'>MogileStore</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id mogile_config'>mogile_config</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='symbol'>:foo</span> <span class='op'>=&gt;</span> <span class='symbol'>:bar</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>

<h3>Note on Patches/Pull Requests</h3>

<ul>
<li>Fork the project.</li>
<li>Make your feature addition or bug fix.</li>
<li>Add tests for it. This is important so I don't break it in a
future version unintentionally.</li>
<li>Commit, do not mess with rakefile, version, or history.
(if you want to have your own version, that is fine but bump version in a commit by itself I can ignore when I pull)</li>
<li>Send me a pull request. Bonus points for topic branches.</li>
</ul>


<h3>Copyright</h3>

<p>Copyright (c) 2010 Cyril David. See LICENSE for details.</p></div></div>
    
    <div id="footer">
  Generated on Fri Jun  4 15:57:28 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool">yard</a>
  0.5.4 (ruby-1.9.1).
</div>

  </body>
</html>